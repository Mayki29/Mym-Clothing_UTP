<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tienda</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/style_form.css}" />
    <script src="https://www.paypal.com/sdk/js?client-id=AbTmLH_ZnqUla3JUOwD7KmoPg8_Wjfy-P185YoEcFbqG-zq60N14mM2OuuizvEpvMWGCvN5WLc6O4Q2O&currency=USD"></script>
    
</head>

<body>
    <!-- Inicia la creacion del header-->

    <header th:replace="~{fragments/header :: header}">
    </header>

    <!-- Finaliza la creacion del header-->

    <!-- Inicia la creacion de INICIO de la pagina-->

    <section class="inicio" id="inicio">

        <div class="content">
            <h3>NUEVA COLECCIÓN</h3>
            <p>Otoño/Invierno 2024</p>
            <a href="#" class="btn">get yours now</a>
            <div class="image">
                <img src="img/icono-bienvenida.png" alt="">
            </div>
        </div>

        <section class="home">
            <div class="form_container">
                <i class="uil uil-times form_close"></i>
                <!-- Login From -->
                <div class="form login_form">
                    <form th:action="@{/access/login}" method="post" th:object="${usuario}">
                        <h2>Inicia sesión en MYM</h2>

                        <div class="input_box">
                            <input type="email" name="email" placeholder="Ingresa tu correo electronico" required />
                            <i class="uil uil-envelope-alt email"></i>
                        </div>
                        <div class="input_box">
                            <input type="password" name="password" placeholder="Ingresa tu contraseña" required />
                            <i class="uil uil-lock password"></i>

                        </div>

                        <div class="option_field">
                            <span class="checkbox">
                                <input type="checkbox" id="check" />
                                <label for="check" class="remember">Recordar contraseña</label>
                            </span>
                            <a href="#" class="forgot_pw">¿Olvidaste tu contraseña?</a>
                        </div>

                        <button class="button" type="submit">Iniciar Sesión</button>

                        <div class="login_signup">¿No tienes una cuenta aún? <a href="#" id="signup">Registrate</a>
                        </div>
                    </form>
                </div>

                <!-- Signup From -->
                <div class="form signup_form">
                    <form th:action="@{/access/registrar}" method="post" th:object="${usuario}">
                        <h2>Registrate en MYM</h2>

                        <div class="input_box">
                            <input type="text" name="nombres" placeholder="Ingrese su nombre" required />
                            <i class="uil uil-envelope-alt email"></i>
                        </div>
                        <div class="input_box">
                            <input type="text" name="apellidos" placeholder="Ingrese su apellido" required />
                            <i class="uil uil-envelope-alt email"></i>
                        </div>
                        <div class="input_box">
                            <input type="email" name="email" placeholder="Ingrese su correo electronico" required />
                            <i class="uil uil-envelope-alt email"></i>
                        </div>
                        <div class="input_box">
                            <input type="password" name="password" placeholder="Crear contraseña" required />
                            <i class="uil uil-lock password"></i>
                        </div>
                        <div class="input_box">
                            <input type="password" placeholder="Confirmar contraseña" required />
                            <i class="uil uil-lock password"></i>
                        </div>
                        <!--div class="input_box">
                            <input type="tel" placeholder="Ingrese su numero de telefono" required />
                            <i class="uil uil-phone phone"></i>
                        </div-->

                        <button class="button" type="submit">Registrate Ahora</button>

                        <div class="login_signup">¿Ya tienes una cuenta?<a href="#" id="login"> Inicia Sesión</a>
                        </div>
                    </form>
                </div>
                <!-- password -->
                <div class="form forgot_password_form">
                    <form action="#">
                        <h2>Olvidaste tu contraseña</h2>

                        <div class="input_box">
                            <input type="email" placeholder="Ingrese su correo electronico" required />
                            <i class="uil uil-envelope-alt email"></i>
                        </div>
                        <div class="input_box">
                            <input type="tel" placeholder="Ingrese su numero de telefono" required />
                            <i class="uil uil-phone phone"></i>
                        </div>

                        <button class="button" onclick="redireccionar2()">Enviar codigo de recuperación</button>

                        <div class="login_signup">¿Recuerda su contraseña? <a href="#" id="back_to_login">Inicia
                                Sesión</a></div>

                        <div class="login_signup">¿No tienes una cuenta aún? <a href="#"
                                id="back_to_signup">Registrate</a>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </section>

    <!-- Finaliza la creacion de INICIO de la pagina-->

    <!-- Inicia la creacion de la opcion "CATALAGO" de la pagina-->

    <section class="catalogo" id="catalogo">
        <h1 class="heading">nuestro <span> catalogo</span></h1>

        <div class="box-container">
            <div th:each="producto : ${productos}" class="box">
                <div class="icons">
                    <a class="bi bi-cart3 btn-agregar-carrito"></a>
                    <a href="" class="bi bi-eye-fill"></a>
                </div>
                <div class="image">
                    <img th:src="@{${'/imgProductos/'+producto.urlImagen}}" alt="" />
                </div>
                <div class="content">
                    <h3 th:text="${producto.nombreProducto}">ropa</h3>
                    <input type="hidden" th:value="${producto.id}" name="id">
                    <div th:text="${'S/. '+producto.precioVenta}" class="price"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Finaliza la creacion de la opcion "PRODUCTOS" de la pagina-->

    <!-- Inicia la creacion de la opcion "DESCUENTOS" de la pagina-->

    <!--section class="descuentos" id="descuentos">
        <h1 class="heading">productos <span> destacados</span></h1>
        <div class="box-container">
            <div class="box">
                <img src="img/icono-ropa.png" alt="" />
                <h3>Polo</h3>
                <div class="price">S/. 19.99 <span>29.99</span></div>
                <a href="#" class="btn">agregar al carrito</a>
            </div>

            <div class="box">
                <img src="img/icono-ropa.png" alt="" />
                <h3>Polo</h3>
                <div class="price">S/. 19.99 <span>29.99</span></div>
                <a href="#" class="btn">agregar al carrito</a>
            </div>

            <div class="box">
                <img src="img/icono-ropa.png" alt="" />
                <h3>Polo</h3>
                <div class="price">S/. 19.99 <span>29.99</span></div>
                <a href="#" class="btn">agregar al carrito</a>
            </div>

            <div class="box">
                <img src="img/icono-ropa.png" alt="" />
                <h3>Polo</h3>
                <div class="price">S/. 19.99 <span>29.99</span></div>
                <a href="#" class="btn">agregar al carrito</a>
            </div>

            <div class="box">
                <img src="img/icono-ropa.png" alt="" />
                <h3>Polo</h3>
                <div class="price">S/. 19.99 <span>29.99</span></div>
                <a href="#" class="btn">agregar al carrito</a>
            </div>

            <div class="box">
                <img src="img/icono-ropa.png" alt="" />
                <h3>Polo</h3>
                <div class="price">S/. 19.99 <span>29.99</span></div>
                <a href="#" class="btn">agregar al carrito</a>
            </div>
        </div>
    </section-->

    <!-- Finaliza la creacion de la opcion "DESCUENTOS" de la pagina-->

    <!-- Inicia la creacion de la opcion "NOSOTROS" de la pagina-->

    <section class="nosotros" id="nosotros">
        <h1 class="heading"><span> acerca</span> de nosotros</h1>

        <div class="row">
            <div class="image">
                <img src="img/icono-nosotros.png" alt="" />
            </div>

            <div class="content">
                <h3>Quienes somos</h3>
                <p>
                    En M&M, nos dedicamos a ofrecer ropa de alta calidad y a la moda para mujeres. 
                    Nuestro objetivo es empoderarte con prendas que realcen tu estilo único y te hagan 
                    sentir segura y fabulosa en cualquier ocasión. Exploramos las últimas tendencias y 
                    seleccionamos cuidadosamente cada pieza para asegurarnos de que siempre encuentres 
                    algo especial en nuestra colección. Gracias por elegir M&M como tu destino de moda.
                </p>
                <p>
                    Gracias por elegir M&M como tu destino de moda.
                </p>
                <a href="#" class="btn"> Saber más</a>
            </div>
        </div>
    </section>

    <!-- Finaliza la creacion de la opcion "NOSOTROS" de la pagina-->

    <!-- Inicia la creacion del FOOTER-->

    <section th:replace="~{fragments/footer.html :: #footer}">

    </section>

    <!-- Finaliza la creacion del FOOTER-->
    
    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- JavaScript link-->
    <script src="js/javascript.js"></script>
    <script src="js/script_form.js"></script>
    <script src="js/carrito.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
            const listaProductos = /*[[${productos}]]*/ '[]';
            /*<![CDATA[*/
            const sesion = /*[[${sesion}]]*/ null;
        /*]]>*/
        /*]]>*/
    </script>
    <script>
        paypal.Buttons({
            onInit(data, actions) {
                    if(sesion != null && sesion != undefined && sesion != {}  ){
                        actions.enable();
                    }else{
                        actions.disable()
                        
                    }
            },
            onClick() {
                    // Show a validation error if the checkbox isn't checked
                    if(obtenerTotal() == 0){
                        alert("Debe tener productos en el carrito")
                    } else{
                        if(sesion == null || sesion == undefined || sesion == {}  ){
                            alert("Debe iniciar sesion")
                        }
                    }
                },
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: obtenerTotal(), // Reemplazable según el monto total a pagar
                            currency_code: 'USD' // Moneda peruana
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    // Aquí se puede manejar la respuesta de PayPal y enviar los datos al backend
                    // Enviar los detalles de la transacción al backend
                    fetch('/process-payment', {
                        method: 'post',
                        headers: {
                            'content-type': 'application/json'
                        },
                        body: JSON.stringify({
                            orderID: data.orderID
                        })
                    }).then(function(response) {
                        if(response.ok) {
                            //alert('Payment processed successfully');
                            registrarVenta()
                            limpiarCarrito()
                            location.reload()
                        } else {
                            alert('Payment processing failed');
                        }
                    });
                });
            }
        }).render('#paypal-button-container');
    </script>

 <!-- Otros meta y enlaces -->
    <script src="https://js.stripe.com/v3/"></script>

</body>

</html>
